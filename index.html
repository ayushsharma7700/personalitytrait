<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personality Rater</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>🌟 Personality Rater 🌟</h1>

<div id="loginSection">
    <input type="text" id="raterName" placeholder="Enter your name">
    <button id="startBtn">Start Rating</button>
</div>

<div id="ratingSection" class="hidden">
    <h2 id="welcomeText"></h2>
    <p>Select person to rate:</p>
    <select id="targetSelect">
        <option value="">--Choose a name--</option>
        <option>Ayush</option>
        <option>Kiran</option>
        <option>Aditya</option>
        <option>Ishu</option>
        <option>Antara</option>
        <option>Neha</option>
        <option>Obaid</option>
    </select>

    <div id="traitsContainer"></div>

    <div class="starsRating">
        <h3>Star Rating:</h3>
        <input type="radio" name="rating" id="star5" value="5"><label for="star5">★</label>
        <input type="radio" name="rating" id="star4" value="4"><label for="star4">★</label>
        <input type="radio" name="rating" id="star3" value="3"><label for="star3">★</label>
        <input type="radio" name="rating" id="star2" value="2"><label for="star2">★</label>
        <input type="radio" name="rating" id="star1" value="1"><label for="star1">★</label>
    </div>

    <button id="submitBtn">Submit Rating</button>

    <div id="result"></div>
    <hr>
    <button id="viewBtn">View Who Rated You</button>
    <div id="ratingsList" class="hidden"></div>
</div>

<!-- Firebase CDN -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where } 
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // 🔥 Replace with your Firebase config
   const firebaseConfig = {
    apiKey: "AIzaSyCpFfZG2wTUidK06-bdaw9aqBQQBO4xMqc",
    authDomain: "personality-rating.firebaseapp.com",
    projectId: "personality-rating",
    storageBucket: "personality-rating.firebasestorage.app",
    messagingSenderId: "1056348504143",
    appId: "1:1056348504143:web:e48f5b49bedfacb3b7ea3a",
    measurementId: "G-VGN3DFRCQD"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Traits
  const traits = ["Kind","Helpful","Honest","Creative","Loyal","Caring","Hardworking","Generous","Friendly","Confident","Responsible","Respectful","Polite","Patient","Courageous","Selfish","Arrogant","Lazy","Jealous","Rude","Dishonest","Impulsive","Pessimistic","Aggressive","Insecure","Overconfident","Greedy","Forgiving","Optimistic","Calm"];

  let chosen = {};
  let raterName = "";

  const startBtn = document.getElementById("startBtn");
  startBtn.addEventListener("click", ()=>{
      const name = document.getElementById("raterName").value.trim();
      if(!name){ alert("Enter your name"); return; }
      raterName = name;
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("ratingSection").classList.remove("hidden");
      document.getElementById("welcomeText").innerText = `Welcome ${raterName}!`;
      displayTraits();
  });

  function displayTraits(){
      const container = document.getElementById("traitsContainer");
      container.innerHTML="";
      traits.forEach(trait=>{
          const div = document.createElement("div");
          div.className="trait-card";
          div.innerHTML = `
              <h4>${trait}</h4>
              <button class="yes-btn" data-trait="${trait}" data-choice="Yes">Yes</button>
              <button class="no-btn" data-trait="${trait}" data-choice="No">No</button>
          `;
          container.appendChild(div);
      });
  }

  document.addEventListener("click",(e)=>{
      if(e.target.matches(".yes-btn,.no-btn")){
          const trait = e.target.dataset.trait;
          const choice = e.target.dataset.choice;
          chosen[trait]=choice;
          const parent = e.target.parentElement;
          parent.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
          e.target.classList.add("active");
      }
  });

  document.getElementById("submitBtn").addEventListener("click", async ()=>{
      const target = document.getElementById("targetSelect").value;
      const rating = document.querySelector("input[name='rating']:checked");
      if(!target){ alert("Select a person"); return; }
      if(!rating){ alert("Select star rating"); return; }
      const yesCount = Object.values(chosen).filter(v=>v==="Yes").length;

      const data = {
          from: raterName,
          to: target,
          traits: chosen,
          rating: rating.value,
          yesCount,
          date: new Date().toLocaleString()
      };

      try{
          await addDoc(collection(db,"ratings"),data);
          document.getElementById("result").innerHTML=`✅ You rated ${target} with ${yesCount} positive traits and ${rating.value} stars!`;
          chosen={};
      }catch(e){ alert("Error saving rating"); console.error(e); }
  });

  document.getElementById("viewBtn").addEventListener("click", async ()=>{
      const listDiv = document.getElementById("ratingsList");
      listDiv.classList.remove("hidden");
      listDiv.innerHTML="<p>Loading...</p>";

      const q = query(collection(db,"ratings"),where("to","==",raterName));
      const querySnapshot = await getDocs(q);

      if(querySnapshot.empty){ listDiv.innerHTML="<p>No one has rated you yet 😔</p>"; return; }

      listDiv.innerHTML="<h3>Who Rated You:</h3>";
      querySnapshot.forEach(doc=>{
          const r = doc.data();
          listDiv.innerHTML+=`<p>⭐ <b>${r.from}</b> rated ${r.rating} stars with ${r.yesCount} positive traits on ${r.date}</p>`;
      });
  });
</script>

</body>
</html>
